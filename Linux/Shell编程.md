# Shell编程

## 概述

通过编写Shell命令发送给linux内核去执行, 操作就是计算机硬件. 所以Shell命令是用户操作计算机硬件的桥梁,

Shell是命令,  类似于windows系统Dos命令

Shell是一个门程序设计语言, Shell里面含有变量, 函数, 逻辑控制语句等等

通过Shell命令与编程语言来提高linux系统的管理工作效率

![image-20200706133643436](images/image-20200706133643436.png)

输出数据到文件中的命令:

`数据 >> 文件`

### Shell的配置文件分类

1.全局配置文件
/etc/profile
/etc/profile.d/*.sh
/etc/bashrc

2.个人配置文件
当前用户/.bash_profile
当前用户/.bashrc

一般情况下，我们都是直接针对全局配置进行操作。

### 常用系统环境变量

| 变量名称     | 含义                                                         |
| ------------ | ------------------------------------------------------------ |
| ==PATH==     | 与windows环境变量PATH功能一样，设置命令的搜索路径，以冒号为分割 |
| HOME         | 当前用户主目录：/root                                        |
| SHELL        | 当前shell解析器类型：/bin/bash                               |
| ==HISTFILE== | 显示当前用户执行命令的历史列表文件：/root/.bash_history      |
| PWD          | 显示当前所在路径：/root                                      |
| OLDPWD       | 显示之前的路径                                               |
| HOSTNAME     | 显示当前主机名：itheima                                      |
| HOSTTYPE     | 显示主机的架构，是i386、i686、还是x86、x64等：x86_64         |
| ==LANG==     | 设置当前系统语言环境：zh_CN.UTF-8                            |

### Shell变量

#### 变量定义规则

1. 变量名称可以有字母,数字和下划线组成, 但是不能以数字开头
2. 等号两侧不能有空格
3. 在bash环境中, 变量的默认类型都是字符串类型, 无法直接进行数值运算
4. 变量的值如果有空格, 必须使用双引号括起来
5. 不能使用Shell的关键字作为变量名称

**注意：**普通输出变量值直接使用`$`就行，进行拼接时要使用`{}`

#### 变量删除

```
unset var_name
```

#### 只读变量

```
readonly var_name
```

#### 定义全局变量

```
export var_name1 var_name2
```

#### 特殊变量

#### 特殊变量：$n

语法

```shell
$n
```

含义

```shell
用于接收脚本文件执行时传入的参数
$0 用于获取当前脚本文件名称的
$1~$9, 代表获取第一输入参数到第9个输入参数
第10个以上的输入参数获取参数的格式: ${数字}, 否则无法获取
```

执行脚本文件传入参数语法

```shell
sh 脚本文件 输入参数1 输入参数2 ...
```



循环语法

```
for var in 列表变量
do		# 循环开始
   命令  # 循环体
done    # 循环结束
```



| 特殊变量     | 含义                                                         |
| ------------ | ------------------------------------------------------------ |
| `$n`         | 获取输入参数的<br>`$0`,  获取当前Shell脚本文件名字<br>`$1~$9`, 获取第一个输入参数到第九个输入参数<br>`${10}`  获取10和10以上的参数需要使用花括号 |
| `$#`         | 获取所有输入参数的个数                                       |
| `$*` 与 `$@` | 获取所有输入参数数据<br>区别: 如果不使用双引号, 功能一样, <br>获取所有参数数据为一个字符串, 如果使用了双引号, <br>`$@`获取的就是参数列表对象, 每个参数都是一个独立字符串, |
| `$?`         | 获取上一个命令的退出状态码, 一般;来说0代表命令成功, 非0代表执行失败 |
| `$$`         | 获取当前shell环境进程的ID号                                  |



### 创建环境变量步骤

1. 编辑/etc/profile全局配置文件

   ```shell
   # 增加命令: 定义变量VAR1=VAR1 并导出为环境变量
   # 扩展: vim里面的命令模式使用G快速定位到文件末尾位置, 使用gg定位到文件首行位置
   ```

2. 重载配置文件/etc/profile, 因为配置文件修改后要立刻加载里面的数据就需要重载, 语法

   ```shell
   source /etc/profile
   ```

3. 在Shell环境中读取系统级环境变量VAR1



### 创建环境变量演示

编辑/etc/profile文件

```shell
vim /etc/profile
```



添加设置变量VAR1=VAR1并导出成为环境变量, 在/etc/profile文件末尾添加如下命令

```shell
# 创建环境变量
VAR1=VAR1
export VAR1
```

重新加载/etc/profile文件数据更新系统环境变量

```shell
source /etc/profile
```

> 注意：如果这一步不执行，无法读取更新的环境变量

3、输出环境变量VAR1

```shell
echo $VAR1
```

## Shell字符串

由双引号`" "`包围的字符串：

其中包含了变量，那么该变量会被解析得到值，而不是原样输出。

字符串中还可以出现双引号的子字符串，但是需要转义。

推荐使用双引号表示字符串。

### 获取字符串长度

${#字符串变量名}

### 字符串截取

| 格式                       | 说明                                                         |
| -------------------------- | ------------------------------------------------------------ |
| `${变量名:start:length}`   | 从 string 字符串的左边第 start 个字符开始，<br>向右截取 length 个字符。start从0开始 |
| `${变量名:start}`          | 从 string 字符串的左边第 start 个字符开始截取，直到最后。    |
| `${变量名:0-start:length}` | 从 string 字符串的右边第 start 个字符开始，<br>向右截取 length 个字符。start从1开始, 代表右侧第一个字符 |
| `${变量名:0-start}`        | 从 string 字符串的右边第 start 个字符开始截取，直到最后。    |
| `${变量名#*chars}`         | 从 string 字符串左边第一次出现 *chars 的位置开始，<br>截取 *chars 右边的所有字符。 |
| `${变量名##*chars}`        | 从 string 字符串左边最后一次出现 *chars 的位置开始，<br>截取 *chars 右边的所有字符。 |
| `${变量名%chars*}`         | 从 string 字符串右边第一次出现 chars* 的位置开始，<br>截取 chars* 左边的所有字符。 |
| `${变量名%%chars*}`        | 从 string 字符串右边最后一次出现 chars* 的位置开始，<br>截取 chars* 左边的所有字符 |

## Shell数组

### 语法

在 Shell 中，用括号`( )`来表示数组，数组元素之间用空格来分隔. 语法为：

```shell
array_name=(item1  item2 ...)  # 方式1
array_name=([索引下标1]=item1  [索引下标2]=item2  ...)  # 方式2
```

> 注意，赋值号 `=` 两边不能有空格

### 演示

1.定义数字存储100,3,22,58,77,17,20

```shell
nums=(29 100 13 8 91 44)
```

2.Shell 是弱类型的，它并不要求所有数组元素的类型必须相同

```shell
arr=(20 56 "http://www.itcast.cn/")
```

Shell数组元素定义后不是固定的,  定义后还可以赋值

```shell
arr[6]=100
```

3.可以给指定元素赋值初始化

```shell
arr2=([0]=1 [2]=100 [4]=aa)
```

## 数组的获取

### 语法

1.通过下标获取元素值,index从0开始

```shell
${arr[index]}
```

> 注意使用`{ }`

2.获取值同时复制给其他变量

```shell
item=${arr[index]}
```

3.使用 `@` 或 `*` 可以获取数组中的所有元素

```shell
${arr[@]}
${arr[*]}
```

4.获取数组的长度或个数

```shell
${#arr[@]}
${#arr[*]}
```

5.获取数组指定元素的字符长度

```shell
${#arr[索引]}
```



使用 `@` 和 `*` 获取数组所有元素之后进行拼接

```shell
array_new=(${array1[@]} ${array2[@]} ...)
array_new=(${array1[*]} ${array2[*]} ...)
```

删除数组指定元素数据

```shell
unset array_name[index]
```

删除整个数组

```shell
unset array_name
```

## 内置命令列表

使用type 来确定一个命令是否是内置命令：

```
type 命令
```

## alias别名定义语法

```shell
alias 别名="命令"
```

> 这里使用单引号或双引号都可以



## unalias 别名删除语法

删除指定的别名

```shell
unalias 别名
```

删除当前Shell环境中所有的别名

```shell
unalias -a
```

> 注意:  以上2种方式删除都是临时删除当前Shell的别名,  如果想永久删除必须去配置文件中手动删除

# Shell内置命令：echo输出字符串

## 目标

1.能够echo输出不换行的字符串

2.能够使用echo输出转义字符



## echo命令介绍

echo 是一个 Shell 内置命令，用于在终端输出字符串，并在最后默认加上换行符



## echo输出语法

默认输出换行语法

```shell
echo 字符串
```



输出不换行语法

```shell
echo -n  字符串
```

## echo输出转义字符

### `\n` 转义字符

用于echo输出字符串非结尾处的换行,  但是默认echo无法解析`/n` 转义字符

### `-e` 参数

`-e` 参数用于解析转义字符

```shell
echo -e '字符串中含有转义字符'
```

### `/c` 转义字符

`/c` 用于强制清除echo的结尾换行输出

# Shell内置命令：read读取控制台输入

## 目标

理解read命令的作用

使用read给多个变量赋值

使用read读取1个字符

使用read限制时间输入

options支持的参数

| 选项           | 说明                                                         |
| -------------- | ------------------------------------------------------------ |
| -a array       | 把读取的数据赋值给数组 array，从下标 0 开始。                |
| -d delimiter   | 用字符串 delimiter 指定读取结束的位置，而不是一个换行符（读取到的数据不包括 delimiter）。 |
| -e             | 在获取用户输入的时候，对功能键进行编码转换，不会直接显式功能键对应的字符。 |
| ==-n num==     | 读取 num 个字符，而不是整行字符。                            |
| ==-p  prompt== | 显示提示信息，提示内容为 prompt。                            |
| -r             | 原样读取（Raw mode），不把反斜杠字符解释为转义字符。         |
| ==-s==         | 静默模式（Silent mode），不会在屏幕上显示输入的字符。<br>当输入密码和其它确认信息的时候，这是很有必要的。 |
| ==-t seconds== | 设置超时时间，单位为秒。如果用户没有在指定时间内输入完成，<br>那么 read 将会返回一个非 0 的退出状态，表示读取失败。 |
| -u fd          | 使用文件描述符 fd 作为输入源，而不是标准输入，类似于重定向。 |

`exit` 用于退出当前Shell环境进程结束运行, 并且可以返回一个状态码.一般使用 `$?` 可以获取退出状态码

## exit应用场景

1.结束当前Shell进程

2.当Shell 进程执行出错退出时，可以返回不同的状态值代表不同的错误

> 比如执行一个脚本文件里面操作一个文件时，可以返回1 表示文件不存在，2 表示文件没有读取权限，3 表示文件类型不对。



### declare设置变量的属性语法

## 

```shell
declare [+/-][aArxif][变量名称＝设置值]
```

> +/- 　"-"可用来指定变量的属性，"+"则是取消变量所设的属性。
>
> a    array,设置为普通索引数组
>
> A    Array,设置为key-value关联数组
>
> r 　readonly,将变量设置为只读,  也可以使用readonly
>
> x 　exprot,设置变量成为全局变量，也可以使用export
>
> i 　int,设置为整型变量。
>
> f     function,设置为一个函数变量

## 实现key-value关联数组变量语法

关联数组也称为“键值对（key-value）”数组，键（key）也即字符串形式的数组下标，值（value）也即元素值。

```shell
declare -A 关联数组变量名=([字符串key1]=值1 [字符串key2]=值2 ...)
```

> declare也可以用于定义普通索引数组,  `-a` 参数创建普通或索引数组   `-A` 创建关联数组
>
> `declare -a 关联数组变量名=(值1 值2 ...)`  
>
> `declare -a 关联数组变量名=([0]=值1 [1]=值2 ...)`  

获取指定key的值

```shell
${关联数组变量名[key]}
```

获取所有值

```shell
${关联数组变量名[*]} # 方式1
${关联数组变量名[@]} # 方式2
```

